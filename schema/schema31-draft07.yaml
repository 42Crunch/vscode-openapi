$id: 'https://spec.openapis.org/oas/3.1/schema/WORK-IN-PROGRESS'
$schema: 'http://json-schema.org/draft-07/schema#'

description: The description of OpenAPI v3.1.x Documents without Schema Object validation

type: object
properties:
  openapi:
    type: string
    pattern: '^3\.1\.\d+(-.+)?$'
  info:
    $ref: '#/definitions/info'
  jsonSchemaDialect:
    type: string
    format: uri
    default: 'https://spec.openapis.org/oas/3.1/dialect/WORK-IN-PROGRESS'
  servers:
    type: array
    items:
      $ref: '#/definitions/server'
    default:
      - url: /
  paths:
    $ref: '#/definitions/paths'
  webhooks:
    type: object
    additionalProperties:
      $ref: '#/definitions/path-item'
  components:
    $ref: '#/definitions/components'
  security:
    type: array
    items:
      $ref: '#/definitions/security-requirement'
  tags:
    type: array
    items:
      $ref: '#/definitions/tag'
  externalDocs:
    $ref: '#/definitions/external-documentation'
required:
  - openapi
  - info
anyOf:
  - required:
    - paths
  - required:
    - components
  - required:
    - webhooks
allOf:
  - $ref: '#/definitions/specification-extensions'
additionalProperties: false

definitions:
  info:
    $comment: https://spec.openapis.org/oas/v3.1#info-object
    type: object
    properties:
      title:
        type: string
      summary:
        type: string
      description:
        type: string
      termsOfService:
        type: string
        format: uri
      contact:
        $ref: '#/definitions/contact'
      license:
        $ref: '#/definitions/license'
      version:
        type: string
    required:
      - title
      - version
    allOf:
      - $ref: '#/definitions/specification-extensions'
    additionalProperties: false

  contact:
    $comment: https://spec.openapis.org/oas/v3.1#contact-object
    type: object
    properties:
      name:
        type: string
      url:
        type: string
        format: uri
      email:
        type: string
        format: email
    allOf:
      - $ref: '#/definitions/specification-extensions'
    additionalProperties: false

  license:
    $comment: https://spec.openapis.org/oas/v3.1#license-object
    type: object
    properties:
      name:
        type: string
      identifier:
        type: string
      url:
        type: string
        format: uri
    required:
      - name
    dependencies:
      identifier:
        not:
          required:
            - url
    allOf:
      - $ref: '#/definitions/specification-extensions'
    additionalProperties: false

  server:
    $comment: https://spec.openapis.org/oas/v3.1#server-object
    type: object
    properties:
      url:
        type: string
      description:
        type: string
      variables:
        type: object
        additionalProperties:
          $ref: '#/definitions/server-variable'
    required:
      - url
    allOf:
      - $ref: '#/definitions/specification-extensions'
    additionalProperties: false

  server-variable:
    $comment: https://spec.openapis.org/oas/v3.1#server-variable-object
    type: object
    properties:
      enum:
        type: array
        items:
          type: string
        minItems: 1
      default:
        type: string
      description:
        type: string
    required:
      - default
    allOf:
      - $ref: '#/definitions/specification-extensions'
    additionalProperties: false

  components:
    $comment: https://spec.openapis.org/oas/v3.1#components-object
    type: object
    properties:
      schemas:
        type: object
        additionalProperties:
          $ref: '#/definitions/unspecified-schema'
      responses:
        type: object
        additionalProperties:
          $ref: '#/definitions/response-or-reference'
      parameters:
        type: object
        additionalProperties:
          $ref: '#/definitions/parameter-or-reference'
      examples:
        type: object
        additionalProperties:
          $ref: '#/definitions/example-or-reference'
      requestBodies:
        type: object
        additionalProperties:
          $ref: '#/definitions/request-body-or-reference'
      headers:
        type: object
        additionalProperties:
          $ref: '#/definitions/header-or-reference'
      securitySchemes:
        type: object
        additionalProperties:
          $ref: '#/definitions/security-scheme-or-reference'
      links:
        type: object
        additionalProperties:
          $ref: '#/definitions/link-or-reference'
      callbacks:
        type: object
        additionalProperties:
          $ref: '#/definitions/callbacks-or-reference'
      pathItems:
        type: object
        additionalProperties:
          $ref: '#/definitions/path-item'
    patternProperties:
      '^(schemas|responses|parameters|examples|requestBodies|headers|securitySchemes|links|callbacks|pathItems)$':
        propertyNames:
          pattern: '^[a-zA-Z0-9._-]+$'
    allOf:
      - $ref: '#/definitions/specification-extensions'
    additionalProperties: false

  paths:
    $comment: https://spec.openapis.org/oas/v3.1#paths-object
    type: object
    patternProperties:
      '^/':
        $ref: '#/definitions/path-item'
    allOf:
      - $ref: '#/definitions/specification-extensions'
    additionalProperties: false

  path-item:
    $comment: https://spec.openapis.org/oas/v3.1#path-item-object
    type: object
    properties:
      $ref:
        type: string
        format: uri-reference
      summary:
        type: string
      description:
        type: string
      servers:
        type: array
        items:
          $ref: '#/definitions/server'
      parameters:
        type: array
        items:
          $ref: '#/definitions/parameter-or-reference'
      get:
        $ref: '#/definitions/operation'
      put:
        $ref: '#/definitions/operation'
      post:
        $ref: '#/definitions/operation'
      delete:
        $ref: '#/definitions/operation'
      options:
        $ref: '#/definitions/operation'
      head:
        $ref: '#/definitions/operation'
      patch:
        $ref: '#/definitions/operation'
      trace:
        $ref: '#/definitions/operation'
    allOf:
      - $ref: '#/definitions/specification-extensions'
    additionalProperties: false

  operation:
    $comment: https://spec.openapis.org/oas/v3.1#operation-object
    type: object
    properties:
      tags:
        type: array
        items:
          type: string
      summary:
        type: string
      description:
        type: string
      externalDocs:
        $ref: '#/definitions/external-documentation'
      operationId:
        type: string
      parameters:
        type: array
        items:
          $ref: '#/definitions/parameter-or-reference'
      requestBody:
        $ref: '#/definitions/request-body-or-reference'
      responses:
        $ref: '#/definitions/responses'
      callbacks:
        type: object
        additionalProperties:
          $ref: '#/definitions/callbacks-or-reference'
      deprecated:
        default: false
        type: boolean
      security:
        type: array
        items:
          $ref: '#/definitions/security-requirement'
      servers:
        type: array
        items:
          $ref: '#/definitions/server'
    allOf:
      - $ref: '#/definitions/specification-extensions'
    additionalProperties: false

  external-documentation:
    $comment: https://spec.openapis.org/oas/v3.1#external-documentation-object
    type: object
    properties:
      description:
        type: string
      url:
        type: string
        format: uri
    required:
      - url
    allOf:
      - $ref: '#/definitions/specification-extensions'
    additionalProperties: false

  parameter:
    $comment: https://spec.openapis.org/oas/v3.1#parameter-object
    type: object
    properties:
      name:
        type: string
      in:
        enum:
          - query
          - header
          - path
          - cookie
      description:
        type: string
      required:
        default: false
        type: boolean
      deprecated:
        default: false
        type: boolean
      schema:
        $ref: '#/definitions/unspecified-schema'
      content:
        $ref: '#/definitions/content'
        minProperties: 1
        maxProperties: 1
    required:
      - name
      - in
    oneOf:
      - required:
        - schema
      - required:
        - content
    allOf:
      - if:
          properties:
            in:
              const: query
          required:
            - in
        then:
          properties:
            allowEmptyValue:
              default: false
              type: boolean
      - if:
          properties:
            schema: {}
          required:
            - schema
        then:
          allOf:
            - $ref: '#/definitions/styles-for-form'
            - properties:
                style:
                  type: string
                explode:
                  type: boolean
            - $ref: '#/definitions/examples'
            - if:
                properties:
                  in:
                    const: path
                required:
                  - in
              then:
                properties:
                  style:
                    default: simple
                    enum:
                      - matrix
                      - label
                      - simple
                  required:
                    const: true
                required:
                  - required
            - if:
                properties:
                  in:
                    const: header
                required:
                  - in
              then:
                properties:
                  style:
                    default: simple
                    const: simple
            - if:
                properties:
                  in:
                    const: query
                required:
                  - in
              then:
                properties:
                  style:
                    default: form
                    enum:
                      - form
                      - spaceDelimited
                      - pipeDelimited
                      - deepObject
                  allowReserved:
                    default: false
                    type: boolean
            - if:
                properties:
                  in:
                    const: cookie
                required:
                  - in
              then:
                properties:
                  style:
                    default: form
                    const: form
    additionalProperties: false

  parameter-or-reference:
    if:
      type: object
      required:
        - $ref
    then:
      $ref: '#/definitions/reference'
    else:
      $ref: '#/definitions/parameter'

  request-body:
    $comment: https://spec.openapis.org/oas/v3.1#request-body-object
    type: object
    properties:
      description:
        type: string
      content:
        $ref: '#/definitions/content'
      required:
        default: false
        type: boolean
    required:
      - content
    allOf:
      - $ref: '#/definitions/specification-extensions'
    additionalProperties: false

  request-body-or-reference:
    if:
      type: object
      required:
        - $ref
    then:
      $ref: '#/definitions/reference'
    else:
      $ref: '#/definitions/request-body'

  content:
    $comment: https://spec.openapis.org/oas/v3.1#fixed-fields-10
    type: object
    additionalProperties:
      $ref: '#/definitions/media-type'
    propertyNames:
      format: media-range

  media-type:
    $comment: https://spec.openapis.org/oas/v3.1#media-type-object
    type: object
    properties:
      schema:
        $ref: '#/definitions/unspecified-schema'
      encoding:
        type: object
        additionalProperties:
          $ref: '#/definitions/encoding'
    allOf:
      - $ref: '#/definitions/specification-extensions'
      - $ref: '#/definitions/examples'
    additionalProperties: false

  encoding:
    $comment: https://spec.openapis.org/oas/v3.1#encoding-object
    type: object
    properties:
      contentType:
        type: string
        format: media-range
      headers:
        type: object
        additionalProperties:
          $ref: '#/definitions/header-or-reference'
      style:
        default: form
        enum:
          - form
          - spaceDelimited
          - pipeDelimited
          - deepObject
      explode:
        type: boolean
      allowReserved:
        default: false
        type: boolean
    allOf:
      - $ref: '#/definitions/specification-extensions'
      - $ref: '#/definitions/styles-for-form'
    additionalProperties: false

  responses:
    $comment: https://spec.openapis.org/oas/v3.1#responses-object
    type: object
    properties:
      default:
        $ref: '#/definitions/response-or-reference'
    patternProperties:
      '^[1-5](?:[0-9]{2}|XX)$':
        $ref: '#/definitions/response-or-reference'
    minProperties: 1
    allOf:
      - $ref: '#/definitions/specification-extensions'
    additionalProperties: false
    if:
      patternProperties:
        '^[1-5](?:[0-9]{2}|XX)$': false
    then:
      required: [default]

  response:
    $comment: https://spec.openapis.org/oas/v3.1#response-object
    type: object
    properties:
      description:
        type: string
      headers:
        type: object
        additionalProperties:
          $ref: '#/definitions/header-or-reference'
      content:
        $ref: '#/definitions/content'
      links:
        type: object
        additionalProperties:
          $ref: '#/definitions/link-or-reference'
    required:
      - description
    allOf:
      - $ref: '#/definitions/specification-extensions'
    additionalProperties: false

  response-or-reference:
    if:
      type: object
      required:
        - $ref
    then:
      $ref: '#/definitions/reference'
    else:
      $ref: '#/definitions/response'

  callbacks:
    $comment: https://spec.openapis.org/oas/v3.1#callback-object
    type: object
    allOf:
      - $ref: '#/definitions/specification-extensions'
    additionalProperties:
      $ref: '#/definitions/path-item'

  callbacks-or-reference:
    if:
      type: object
      required:
        - $ref
    then:
      $ref: '#/definitions/reference'
    else:
      $ref: '#/definitions/callbacks'

  example:
    $comment: https://spec.openapis.org/oas/v3.1#example-object
    type: object
    properties:
      summary:
        type: string
      description:
        type: string
      value: true
      externalValue:
        type: string
        format: uri
    not:
      required:
        - value
        - externalValue
    allOf:
      - $ref: '#/definitions/specification-extensions'
    additionalProperties: false

  example-or-reference:
    if:
      type: object
      required:
        - $ref
    then:
      $ref: '#/definitions/reference'
    else:
      $ref: '#/definitions/example'

  link:
    $comment: https://spec.openapis.org/oas/v3.1#link-object
    type: object
    properties:
      operationRef:
        type: string
        format: uri-reference
      operationId:
        type: string
      parameters:
        $ref: '#/definitions/map-of-strings'
      requestBody: true
      description:
        type: string
      body:
        $ref: '#/definitions/server'
    oneOf:
      - required:
          - operationRef
      - required:
          - operationId
    allOf:
      - $ref: '#/definitions/specification-extensions'
    additionalProperties: false

  link-or-reference:
    if:
      type: object
      required:
        - $ref
    then:
      $ref: '#/definitions/reference'
    else:
      $ref: '#/definitions/link'

  header:
    $comment: https://spec.openapis.org/oas/v3.1#header-object
    type: object
    properties:
      description:
        type: string
      required:
        default: false
        type: boolean
      deprecated:
        default: false
        type: boolean
      schema:
        $ref: '#/definitions/unspecified-schema'
      content:
        $ref: '#/definitions/content'
        minProperties: 1
        maxProperties: 1
    oneOf:
      - required:
          - schema
      - required:
          - content
    allOf:
      - if:
          properties:
            schema: {}
          required:
            - schema
        then:
          properties:
            style:
              default: simple
              const: simple
            explode:
              default: false
              type: boolean
          allOf:
            - $ref: '#/definitions/examples'
      - $ref: '#/definitions/specification-extensions'
    additionalProperties: false

  header-or-reference:
    if:
      type: object
      required:
        - $ref
    then:
      $ref: '#/definitions/reference'
    else:
      $ref: '#/definitions/header'

  tag:
    $comment: https://spec.openapis.org/oas/v3.1#tag-object
    type: object
    properties:
      name:
        type: string
      description:
        type: string
      externalDocs:
        $ref: '#/definitions/external-documentation'
    required:
      - name
    allOf:
      - $ref: '#/definitions/specification-extensions'
    additionalProperties: false

  reference:
    $comment: https://spec.openapis.org/oas/v3.1#reference-object
    type: object
    properties:
      $ref:
        type: string
        format: uri-reference
      summary:
        type: string
      description:
        type: string

  unspecified-schema:
    $comment: Schema accepting any valid JSON Schema
    type: object
    additionalProperties: true

  schema:
    $comment: https://spec.openapis.org/oas/v3.1#schema-object
    type:
      - object
      - boolean

  security-scheme:
    $comment: https://spec.openapis.org/oas/v3.1#security-scheme-object
    type: object
    properties:
      type:
        enum:
          - apiKey
          - http
          - mutualTLS
          - oauth2
          - openIdConnect
      description:
        type: string
    required:
      - type
    allOf:
      - $ref: '#/definitions/specification-extensions'
      - if:
          properties:
            type:
              const: apiKey
          required:
            - type
        then:
          properties:
            name:
              type: string
            in:
              enum:
                - query
                - header
                - cookie
          required:
            - name
            - in
      - if:
          properties:
            type:
              const: http
          required:
            - type
        then:
          properties:
            scheme:
              type: string
          required:
            - scheme
      - if:
          properties:
            type:
              const: http
            scheme:
              type: string
              pattern: ^[Bb][Ee][Aa][Rr][Ee][Rr]$
          required:
            - type
            - scheme
        then:
          properties:
            bearerFormat:
              type: string
      - if:
          properties:
            type:
              const: oauth2
          required:
            - type
        then:
          properties:
            flows:
              $ref: '#/definitions/oauth-flows'
          required:
            - flows
      - if:
          properties:
            type:
              const: openIdConnect
          required:
            - type
        then:
          properties:
            openIdConnectUrl:
              type: string
              format: uri
          required:
            - openIdConnectUrl
    additionalProperties: false

  security-scheme-or-reference:
    if:
      type: object
      required:
        - $ref
    then:
      $ref: '#/definitions/reference'
    else:
      $ref: '#/definitions/security-scheme'

  oauth-flows:
    type: object
    properties:
      implicit:
        $ref: '#/definitions/oauth-flows-implicit'
      password:
        $ref: '#/definitions/oauth-flows-password'
      clientCredentials:
        $ref: '#/definitions/oauth-flows-client-credentials'
      authorizationCode:
        $ref: '#/definitions/oauth-flows-authorization-code'
    allOf:
      - $ref: '#/definitions/specification-extensions'
    additionalProperties: false

  oauth-flows-implicit:
    type: object
    properties:
      authorizationUrl:
        type: string
        format: uri
      refreshUrl:
        type: string
        format: uri
      scopes:
        $ref: '#/definitions/map-of-strings'
    required:
      - authorizationUrl
      - scopes
    allOf:
      - $ref: '#/definitions/specification-extensions'
    additionalProperties: false

  oauth-flows-password:
    type: object
    properties:
      tokenUrl:
        type: string
        format: uri
      refreshUrl:
        type: string
        format: uri
      scopes:
        $ref: '#/definitions/map-of-strings'
    required:
      - tokenUrl
      - scopes
    allOf:
      - $ref: '#/definitions/specification-extensions'
    additionalProperties: false

  oauth-flows-client-credentials:
    type: object
    properties:
      tokenUrl:
        type: string
        format: uri
      refreshUrl:
        type: string
        format: uri
      scopes:
        $ref: '#/definitions/map-of-strings'
    required:
      - tokenUrl
      - scopes
    allOf:
      - $ref: '#/definitions/specification-extensions'
    additionalProperties: false

  oauth-flows-authorization-code:
    type: object
    properties:
      authorizationUrl:
        type: string
        format: uri
      tokenUrl:
        type: string
        format: uri
      refreshUrl:
        type: string
        format: uri
      scopes:
        $ref: '#/definitions/map-of-strings'
    required:
      - authorizationUrl
      - tokenUrl
      - scopes
    allOf:
      - $ref: '#/definitions/specification-extensions'
    additionalProperties: false

  security-requirement:
    $comment: https://spec.openapis.org/oas/v3.1#security-requirement-object
    type: object
    additionalProperties:
      type: array
      items:
        type: string

  specification-extensions:
    $comment: https://spec.openapis.org/oas/v3.1#specification-extensions
    patternProperties:
      '^x-': true

  examples:
    properties:
      example: true
      examples:
        type: object
        additionalProperties:
          $ref: '#/definitions/example-or-reference'

  map-of-strings:
    type: object
    additionalProperties:
      type: string

  styles-for-form:
    if:
      properties:
        style:
          const: form
      required:
        - style
    then:
      properties:
        explode:
          default: true
    else:
      properties:
        explode:
          default: false
